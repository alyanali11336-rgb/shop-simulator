<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shop Sim - Fixed Controls</title>
    <style>
        body { 
            background: #222; margin: 0; display: flex; 
            justify-content: center; align-items: center; 
            height: 100vh; overflow: hidden;
            font-family: 'Courier New', monospace; 
        }
        
        #game-container {
            position: relative; width: 800px; height: 800px;
            background: url('background.png') no-repeat center;
            background-size: contain; image-rendering: pixelated;
        }

        .sprite { position: absolute; image-rendering: pixelated; }

        /* Customer Gravity Fix */
        #customer { 
            width: 280px; bottom: 180px; left: -350px; 
            z-index: 20; transition: left 1.5s linear; 
        }

        #speech {
            position: absolute; background: white; padding: 10px; 
            border-radius: 10px; border: 3px solid #000; 
            font-weight: bold; display: none; z-index: 30;
            bottom: 450px; left: 300px;
        }

        /* BUTTONS: Inhe visible rakha hai testing ke liye, baad mein border:none kar sakte hain */
        .ui-btn { 
            position: absolute; cursor: pointer; 
            border: 2px solid rgba(255,255,255,0.2); 
            background: rgba(255,255,255,0.05);
            z-index: 100;
        }
        
        #refill-hitbox { width: 180px; height: 60px; bottom: 70px; right: 40px; }
        #upgrade-hitbox { width: 180px; height: 60px; bottom: 70px; right: 240px; }
        #bill-hitbox { width: 250px; height: 120px; bottom: 250px; left: 275px; display: none; }

        .stat-text { position: absolute; color: #ffcc00; font-size: 24px; font-weight: bold; pointer-events: none; }
        #cash-val { bottom: 132px; left: 115px; }
        #stock-val { bottom: 132px; left: 305px; }

        #overlay {
            position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.8);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 200; color: white;
        }
        #start-btn { padding: 20px 50px; font-size: 30px; cursor: pointer; background: #27ae60; color: white; border: none; border-radius: 15px; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="overlay">
        <h2 style="color: #f1c40f;">SHOP SIMULATOR</h2>
        <button id="start-btn" onclick="initGame()">PLAY NOW</button>
        <p>Make sure music.mp3 is in your folder!</p>
    </div>

    <div id="speech"></div>
    <div id="cash-val" class="stat-text">0</div>
    <div id="stock-val" class="stat-text">0</div>

    <img src="lady_customer.png" id="customer" class="sprite">

    <div id="refill-hitbox" class="ui-btn" title="Refill Shop" onclick="refill()"></div>
    <div id="upgrade-hitbox" class="ui-btn" title="Upgrade" onclick="upgrade()"></div>
    <div id="bill-hitbox" class="ui-btn" title="Generate Bill" onclick="generateBill()"></div>
</div>

<audio id="bgMusic" loop>
    <source src="music.mp3" type="audio/mpeg">
</audio>
<audio id="coinSound">
    <source src="coin.mp3" type="audio/mpeg">
</audio>

<script>
    let cash = 0, stock = 0, isCustomerWaiting = false;

    // Music Fix: Browser permissions
    function initGame() {
        document.getElementById('overlay').style.display = 'none';
        let music = document.getElementById('bgMusic');
        music.play().then(() => {
            console.log("Music Playing");
        }).catch(err => {
            console.log("Music Error: Make sure music.mp3 exists!");
        });

        // Customer Logic
        setInterval(() => {
            if (!isCustomerWaiting && stock > 0) spawnCustomer();
        }, 4000);
    }

    function spawnCustomer() {
        isCustomerWaiting = true;
        const cust = document.getElementById('customer');
        const speech = document.getElementById('speech');
        const bill = document.getElementById('bill-hitbox');

        cust.style.left = "260px"; 
        setTimeout(() => {
            speech.innerText = "BILL PLEASE!";
            speech.style.display = "block";
            bill.style.display = "block";
        }, 1500);
    }

    function generateBill() {
        document.getElementById('coinSound').play();
        cash += 25;
        stock--;
        updateUI();
        
        document.getElementById('bill-hitbox').style.display = "none";
        document.getElementById('speech').innerText = "THANKS!";
        setTimeout(leave, 1000);
    }

    function leave() {
        document.getElementById('speech').style.display = "none";
        document.getElementById('customer').style.left = "900px";
        setTimeout(() => {
            document.getElementById('customer').style.transition = "none";
            document.getElementById('customer').style.left = "-350px";
            setTimeout(() => {
                document.getElementById('customer').style.transition = "left 1.5s linear";
                isCustomerWaiting = false;
            }, 50);
        }, 1500);
    }

    function refill() {
        if (cash >= 50 || stock === 0) {
            if (cash >= 50) cash -= 50;
            stock = 5;
            updateUI();
            document.getElementById('game-container').style.backgroundImage = "url('background_full.png')";
        }
    }

    function upgrade() {
        if (cash >= 200) {
            cash -= 200;
            updateUI();
            alert("Upgraded!");
        }
    }

    function updateUI() {
        document.getElementById('cash-val').innerText = cash;
        document.getElementById('stock-val').innerText = stock;
        if (stock <= 0) {
            document.getElementById('game-container').style.backgroundImage = "url('background.png')";
        }
    }
</script>
</body>
</html>
