<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shop Sim - WASD Manual Control</title>
    <style>
        body { 
            background: #f3c592; margin: 0; display: flex; flex-direction: column;
            justify-content: center; align-items: center; height: 100vh; overflow: hidden;
            font-family: 'Courier New', monospace; 
        }
        
        #game-window {
            position: relative; width: 800px; height: 600px;
            background: #222 url('background.png') no-repeat center;
            background-size: 100% 100%; border: 10px solid #5d4037; 
            overflow: hidden; box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }

        .sprite { position: absolute; image-rendering: pixelated; }

        /* GROUNDED PHYSICS */
        .shelf { width: 150px; bottom: 275px; z-index: 1; border: 2px solid transparent; }
        .highlight { border-color: #0f0; background: rgba(0,255,0,0.1); }
        #s1 { left: 80px; } #s2 { left: 570px; } 

        /* Player moves via JS */
        #player { width: 170px; bottom: 285px; left: 315px; z-index: 5; transition: left 0.1s linear; }
        #counter { width: 300px; bottom: 180px; left: 250px; z-index: 10; }

        #customer { width: 240px; bottom: 20px; left: -350px; z-index: 20; transition: left 1.2s linear; }

        #speech {
            position: absolute; background: white; padding: 8px; border-radius: 10px;
            border: 2px solid #000; font-weight: bold; display: none; z-index: 30;
        }

        #inventory-ui {
            position: absolute; top: 10px; left: 10px; color: white;
            background: rgba(0,0,0,0.7); padding: 5px 10px; border-radius: 5px;
        }

        /* UI PANEL */
        #ui-panel {
            width: 800px; padding: 20px; display: flex; justify-content: space-between;
            align-items: center; background: #e1b382; border: 5px solid #5d4037;
            border-radius: 0 0 20px 20px; margin-top: -5px;
        }

        .stat-card { background: #5d4037; color: #fff; padding: 10px 20px; border-radius: 8px; font-weight: bold; }
        button { padding: 12px 20px; cursor: pointer; border: none; font-weight: bold; border-radius: 8px; color: white; }
        .btn-refill { background: #d35400; }
    </style>
</head>
<body>

<div id="game-window">
    <div id="inventory-ui">HAND: <span id="held-item">EMPTY</span></div>
    <div id="speech"></div>

    <img src="shelf_full.png" id="s1" class="sprite shelf">
    <img src="shelf_full.png" id="s2" class="sprite shelf">
    <img src="player (2).png" id="player" class="sprite">
    <img src="counter.png" id="counter" class="sprite">
    <img src="customer.png" id="customer" class="sprite">
</div>

<div id="ui-panel">
    <div style="display:flex; gap:10px;">
        <div class="stat-card">ðŸ’° $<span id="bal">0</span></div>
        <div class="stat-card">ðŸ“¦ <span id="stock">5</span>/5</div>
    </div>
    <div style="font-weight:bold; color:#5d4037;">Use A/D to MOVE | E to PICK/DROP</div>
    <button id="refillBtn" class="btn-refill" onclick="refill()" style="display:none">Refill ($50)</button>
</div>

<script>
    let cash = 0, stock = 5, playerPos = 315;
    let heldItem = null, isCustomerWaiting = false;
    let customerOrder = null;

    // Movement Controls
    window.addEventListener('keydown', (e) => {
        const p = document.getElementById('player');
        if (e.key.toLowerCase() === 'a' && playerPos > 50) playerPos -= 15;
        if (e.key.toLowerCase() === 'd' && playerPos < 600) playerPos += 15;
        p.style.left = playerPos + 'px';

        if (e.key.toLowerCase() === 'e') interact();
    });

    function interact() {
        // Shelf Check (Pick item)
        if (!heldItem && stock > 0) {
            if (Math.abs(playerPos - 80) < 60 || Math.abs(playerPos - 570) < 60) {
                heldItem = "ITEM";
                document.getElementById('held-item').innerText = "ðŸ“¦ CARRYING ITEM";
            }
        } 
        // Counter Check (Drop to customer)
        else if (heldItem && isCustomerWaiting && Math.abs(playerPos - 315) < 50) {
            completeSale();
        }
    }

    setInterval(() => {
        if (!isCustomerWaiting && stock > 0) spawnCustomer();
    }, 5000);

    function spawnCustomer() {
        isCustomerWaiting = true;
        const cust = document.getElementById('customer');
        const speech = document.getElementById('speech');
        
        const isLady = Math.random() > 0.5;
        cust.src = isLady ? "lady_customer.png" : "customer.png";
        cust.style.width = isLady ? "260px" : "220px";
        cust.style.left = "290px"; 

        setTimeout(() => {
            speech.innerText = "GIVE ME ITEM! (Press E at Counter)";
            speech.style.display = "block";
            speech.style.left = "330px";
            speech.style.bottom = "240px";
        }, 1200);
    }

    function completeSale() {
        cash += 30;
        stock--;
        heldItem = null;
        isCustomerWaiting = false;
        document.getElementById('bal').innerText = cash;
        document.getElementById('stock').innerText = stock;
        document.getElementById('held-item').innerText = "EMPTY";
        document.getElementById('speech').innerText = "THANKS!";
        
        setTimeout(() => {
            document.getElementById('speech').style.display = "none";
            document.getElementById('customer').style.left = "900px";
            if (stock <= 0) {
                document.getElementById('s1').src = 'shelf_empty.png';
                document.getElementById('s2').src = 'shelf_empty.png';
                document.getElementById('refillBtn').style.display = "block";
            }
            setTimeout(() => {
                document.getElementById('customer').style.transition = "none";
                document.getElementById('customer').style.left = "-350px";
                setTimeout(() => document.getElementById('customer').style.transition = "all 1.2s linear", 50);
            }, 1200);
        }, 800);
    }

    function refill() {
        if (cash >= 50) {
            cash -= 50; stock = 5;
            document.getElementById('bal').innerText = cash;
            document.getElementById('stock').innerText = stock;
            document.getElementById('s1').src = 'shelf_full.png';
            document.getElementById('s2').src = 'shelf_full.png';
            document.getElementById('refillBtn').style.display = "none";
        }
    }
</script>
</body>
</html>
