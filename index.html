<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mega Shop Sim - Mobile</title>
    <style>
        :root { --shop-color: #2c3e50; --floor-color: #5d4037; }
        body { margin: 0; overflow: hidden; background: #1a1a1a; font-family: 'Segoe UI', sans-serif; touch-action: manipulation; }
        
        #game-view {
            width: 100vw; height: 60vh; background: var(--shop-color);
            position: relative; border-bottom: 8px solid #3e2723; overflow: hidden;
            transition: background 1s;
        }

        /* Level Based Shop Upgrades */
        .decoration { position: absolute; top: 10px; right: 10px; font-size: 40px; opacity: 0.5; }
        .shelf { position: absolute; top: 20%; width: 80px; height: 100px; background: #4e342e; border: 3px solid #3e2723; display: flex; flex-wrap: wrap; justify-content: center; align-items: center; }

        /* Characters from GitHub Structure */
        #player { position: absolute; bottom: 30%; left: 50%; transform: translateX(-50%); width: 120px; z-index: 10; }
        #customer { position: absolute; bottom: 10%; left: -150px; width: 130px; z-index: 20; transition: left 1.5s linear; }
        #cleaner { position: absolute; bottom: 8%; width: 100px; z-index: 15; transition: left 1s linear; display: none; }
        
        /* Mobile UI */
        #controls { height: 40vh; background: #e1b382; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; box-sizing: border-box; }
        .stat-card { background: #3e2723; color: #f1c40f; padding: 10px; border-radius: 10px; text-align: center; font-size: 1.1rem; border: 2px solid #f1c40f; }
        .action-btn { background: #27ae60; color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 1rem; box-shadow: 0 5px 0 #1e8449; active: transform: translateY(4px); }
        .action-btn:active { transform: translateY(4px); box-shadow: 0 1px 0 #1e8449; }

        #bill-popup { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); background: #f39c12; padding: 15px 30px; border-radius: 50px; color: white; font-weight: bold; display: none; z-index: 100; animation: bounce 0.5s infinite alternate; }
        @keyframes bounce { from { margin-top: 0; } to { margin-top: -10px; } }
    </style>
</head>
<body>

<div id="game-view">
    <div id="shop-deco" class="decoration">ðŸ“¦</div>
    <div class="shelf" style="left: 10%;" id="shelf-1"></div>
    <div class="shelf" style="left: 75%;" id="shelf-2"></div>
    
    <img src="player.png" id="player"> <img src="man_idle.png" id="customer"> <img src="cleaner_idle.png" id="cleaner"> <div id="bill-popup" onclick="collectCash()">TAP TO BILL ðŸ’°</div>
</div>

<div id="controls">
    <div class="stat-card">Cash: $<span id="money">200</span></div>
    <div class="stat-card">Level: <span id="lvl">1</span></div>
    <div class="stat-card">Stock: <span id="stk">0</span>/20</div>
    <div class="stat-card">XP: <span id="xp">0</span>/100</div>
    
    <button class="action-btn" onclick="buyStock()">REFILL STOCK ($20)</button>
    <button class="action-btn" id="cleaner-btn" style="background:#2980b9; box-shadow:0 5px 0 #1a5276;" onclick="hireStaff()">HIRE CLEANER ($150)</button>
</div>

<script>
    let money = 200, level = 1, stock = 0, xp = 0, hasCleaner = false;
    let currentCustType = "";
    const items = ["ðŸŽ", "ðŸž", "ðŸ¥›", "ðŸª", "ðŸ¥¤"];

    // 1. Mobile Friendly Refill
    function buyStock() {
        if (money >= 20) {
            money -= 20; stock = Math.min(stock + 5, 20);
            updateUI(); drawStock();
        }
    }

    // 2. Hidden Feature: XP & Level Upgrade System
    function addXP(amount) {
        xp += amount;
        if (xp >= 100) {
            xp = 0; level++;
            upgradeShop();
        }
        updateUI();
    }

    function upgradeShop() {
        const view = document.getElementById('game-view');
        const deco = document.getElementById('shop-deco');
        if (level == 2) {
            view.style.background = "#34495e";
            deco.innerText = "âœ¨ðŸª";
            alert("Level Up! Shop upgraded to Deluxe!");
        } else if (level == 3) {
            view.style.background = "#2c2c54";
            deco.innerText = "ðŸ’ŽðŸ¦";
            alert("Level Up! You now own a Supermarket!");
        }
    }

    // 3. Customer Spawning based on GitHub Files
    function spawn() {
        const cust = document.getElementById('customer');
        const types = ["man", "old_lady", "police"]; // All from your files
        currentCustType = types[Math.floor(Math.random() * types.length)];
        
        cust.src = `${currentCustType}_walk.png`; //
        cust.style.left = "40%";

        setTimeout(() => {
            cust.src = `${currentCustType}_idle.png`; //
            if (stock > 0) document.getElementById('bill-popup').style.display = 'block';
            else setTimeout(leave, 2000);
        }, 1500);
    }

    function collectCash() {
        let gain = (currentCustType === "police") ? 100 : 50;
        money += gain; stock--; xp += 35;
        document.getElementById('bill-popup').style.display = 'none';
        updateUI(); drawStock(); leave();
    }

    function leave() {
        const cust = document.getElementById('customer');
        cust.src = `${currentCustType}_walk.png`;
        cust.style.left = "110%";
        setTimeout(() => { 
            cust.style.transition = "none"; cust.style.left = "-150px";
            setTimeout(() => { cust.style.transition = "left 1.5s linear"; }, 100);
        }, 1500);
    }

    // 4. Cleaner logic from GitHub Structure
    function hireStaff() {
        if (money >= 150 && !hasCleaner) {
            money -= 150; hasCleaner = true;
            document.getElementById('cleaner').style.display = 'block';
            document.getElementById('cleaner-btn').innerText = "STAFF ACTIVE";
            updateUI();
        }
    }

    function updateUI() {
        document.getElementById('money').innerText = money;
        document.getElementById('lvl').innerText = level;
        document.getElementById('stk').innerText = stock;
        document.getElementById('xp').innerText = xp;
    }

    function drawStock() {
        document.getElementById('shelf-1').innerText = stock > 0 ? items[0].repeat(Math.min(stock, 3)) : "";
        document.getElementById('shelf-2').innerText = stock > 5 ? items[1].repeat(Math.min(stock-5, 3)) : "";
    }

    setInterval(spawn, 6000);
</script>
</body>
</html>
