<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Supermarket Sim - 4 Shelves & Music</title>
    <style>
        :root { --ui-panel: #3e2723; --gold: #f1c40f; }
        body { margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; background: #1a1a1a; overflow: hidden; font-family: sans-serif; }

        /* Stats Bar */
        #top-stats {
            display: grid; grid-template-columns: repeat(4, 1fr);
            background: var(--ui-panel); padding: 12px; border-bottom: 4px solid var(--gold); z-index: 100;
        }
        .stat-item { color: var(--gold); text-align: center; font-size: 0.8rem; font-weight: bold; }

        /* Game View with Floor */
        #game-view { flex: 1; position: relative; background: linear-gradient(#2c3e50 65%, #4a332d 65%); }

        /* 4 Shelves System - Perfectly Aligned */
        .shelf-container { position: absolute; width: 120px; height: 80px; z-index: 5; }
        #sc-1 { top: 20%; left: 5%; }
        #sc-2 { top: 20%; right: 5%; }
        #sc-3 { top: 40%; left: 5%; }
        #sc-4 { top: 40%; right: 5%; }

        .shelf-img { width: 100%; position: absolute; bottom: 0; }
        
        /* Stacked Items Logic */
        .items-stack { 
            position: absolute; bottom: 15px; width: 100%; 
            display: flex; flex-wrap: wrap-reverse; justify-content: center; 
            align-items: flex-end; gap: 2px; padding-bottom: 5px;
        }
        .items-stack span { font-size: 1.3rem; line-height: 1; filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.5)); }

        /* Gravity Fixed Assets */
        #counter-img { position: absolute; bottom: 26%; left: 50%; transform: translateX(-50%); width: 170px; z-index: 15; }
        .char { position: absolute; height: 150px; width: auto; transition: left 1.5s linear; }
        #player { bottom: 33%; left: 50%; transform: translateX(-50%); z-index: 10; }
        #customer { bottom: 10%; left: -200px; z-index: 20; }

        #btn-collect { 
            position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%);
            background: #f39c12; color: white; padding: 15px 30px; border-radius: 50px;
            font-weight: bold; display: none; z-index: 200; border: 3px solid white; box-shadow: 0 0 20px rgba(243,156,18,0.5);
        }

        #controls { height: 12vh; background: #e1b382; display: flex; padding: 10px; gap: 10px; border-top: 5px solid #3e2723; }
        .btn-ui { flex: 1; border: none; border-radius: 10px; font-weight: bold; font-size: 1rem; color: white; cursor: pointer; }
    </style>
</head>
<body>

<audio id="bgMusic" loop>
    <source src="Aylex - Innovating Care (freetouse.com).mp3" type="audio/mpeg">
</audio>

<div id="top-stats">
    <div class="stat-item">CASH<br><span id="cash">$200</span></div>
    <div class="stat-item">LVL<br><span id="lvl">1</span></div>
    <div class="stat-item">STOCK<br><span id="stk">0/100</span></div>
    <div class="stat-item">XP<br><span id="xp">0%</span></div>
</div>

<div id="game-view">
    <div class="shelf-container" id="sc-1"><div class="items-stack" id="stack-1"></div><img src="shelf.png" class="shelf-img"></div>
    <div class="shelf-container" id="sc-2"><div class="items-stack" id="stack-2"></div><img src="shelf.png" class="shelf-img"></div>
    <div class="shelf-container" id="sc-3"><div class="items-stack" id="stack-3"></div><img src="shelf.png" class="shelf-img"></div>
    <div class="shelf-container" id="sc-4"><div class="items-stack" id="stack-4"></div><img src="shelf.png" class="shelf-img"></div>

    <img src="player.png" class="char" id="player"> 
    <img src="counter.png" id="counter-img"> 
    <img src="man_idle.png" class="char" id="customer">

    <div id="btn-collect" onclick="handleSale()">COLLECT CASH üí∞</div>
</div>

<div id="controls">
    <button class="btn-ui" style="background:#27ae60;" onclick="refill()">REFILL ($50)</button>
    <button class="btn-ui" style="background:#2980b9;">UPGRADE SHOP</button>
</div>

<script>
    let cash = 200, lvl = 1, stock = 0, xp = 0, active = false;
    let type = "";
    const items = ["üçé", "ü•õ", "üçû", "üç™", "üçï"];

    // Music Start on First Tap
    document.addEventListener('click', function() {
        const music = document.getElementById('bgMusic');
        if(music.paused) { music.volume = 0.3; music.play(); }
    }, { once: true });

    function update() {
        document.getElementById('cash').innerText = `$${cash}`;
        document.getElementById('lvl').innerText = lvl;
        document.getElementById('stk').innerText = `${stock}/100`;
        document.getElementById('xp').innerText = `${xp}%`;
        
        // Stacked Items Logic: Fill shelves one by one
        for(let s=1; s<=4; s++) {
            const stackDiv = document.getElementById(`stack-${s}`);
            stackDiv.innerHTML = "";
            let start = (s-1) * 25;
            let end = Math.min(stock, s * 25);
            for(let i=start; i<end; i++) {
                stackDiv.innerHTML += `<span>${items[i % items.length]}</span>`;
            }
        }
    }

    function refill() {
        if(cash >= 50) { cash -= 50; stock = Math.min(stock + 40, 100); update(); }
    }

    function spawn() {
        if(active) return;
        active = true;
        const c = document.getElementById('customer');
        const pool = ["man", "old_lady", "police"];
        type = pool[Math.floor(Math.random() * pool.length)];
        c.src = `${type}_walk.png`;
        c.style.left = "42%";

        setTimeout(() => {
            c.src = `${type}_idle.png`;
            if(stock > 0) document.getElementById('btn-collect').style.display = 'block';
            else setTimeout(leave, 1000);
        }, 1500);
    }

    function handleSale() {
        cash += (type === "police") ? 100 : 60;
        stock--; xp += 20;
        document.getElementById('btn-collect').style.display = 'none';
        if(xp >= 100) { xp = 0; lvl++; }
        update(); leave();
    }

    function leave() {
        const c = document.getElementById('customer');
        c.src = `${type}_walk.png`;
        c.style.left = "110%";
        setTimeout(() => {
            c.style.transition = "none"; c.style.left = "-200px";
            setTimeout(() => { c.style.transition = "left 1.5s linear"; active = false; }, 100);
        }, 1500);
    }

    setInterval(spawn, 5000);
    update();
</script>
</body>
</html>
