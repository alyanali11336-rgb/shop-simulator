<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shop Sim - Fixed Garbage & 9-Item Limit</title>
    <style>
        :root { --ui: #3e2723; --gold: #f1c40f; }
        body { margin: 0; display: flex; flex-direction: column; height: 100vh; background: #1a1a1a; overflow: hidden; font-family: sans-serif; }
        #top { background: var(--ui); border-bottom: 4px solid var(--gold); z-index: 100; }
        #stats { display: grid; grid-template-columns: repeat(4, 1fr); padding: 10px; }
        .stat-item { color: var(--gold); text-align: center; font-size: 0.8rem; font-weight: bold; }
        #game { flex: 1; position: relative; background: linear-gradient(#2c3e50 65%, #4a332d 65%); }

        /* Shelves with 9-item Grid */
        .shelf { position: absolute; width: 100px; height: 80px; z-index: 5; }
        #s1 { top: 15%; left: 5%; } #s2 { top: 15%; right: 5%; }
        #s3 { top: 40%; left: 5%; } #s4 { top: 40%; right: 5%; }
        .items { position: absolute; bottom: 15px; width: 100%; display: grid; grid-template-columns: repeat(3, 1fr); justify-items: center; }
        .items span { font-size: 1rem; }

        /* Characters */
        #counter { position: absolute; bottom: 26%; left: 50%; transform: translateX(-50%); width: 160px; z-index: 15; }
        .actor { position: absolute; height: 140px; transition: left 1s linear; z-index: 10; }
        #player { bottom: 33%; left: 50%; transform: translateX(-50%); }
        #customer { bottom: 10%; left: -200px; }
        #cleaner { bottom: 10%; right: 10%; display: none; }
        
        .garbage { position: absolute; bottom: 12%; font-size: 1.5rem; cursor: pointer; z-index: 11; transition: opacity 0.3s; }
        #btn-cash { position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%); background: #f39c12; color: white; padding: 15px 30px; border-radius: 50px; font-weight: bold; display: none; z-index: 200; border: 3px solid white; cursor: pointer; }
        #footer { height: 10vh; background: #e1b382; display: flex; padding: 10px; border-top: 5px solid var(--ui); }
        .btn { flex: 1; border: none; border-radius: 10px; font-weight: bold; color: white; background: #27ae60; cursor: pointer; }
    </style>
</head>
<body>

<audio id="bgm" loop><source src="Aylex - Innovating Care (freetouse.com).mp3" type="audio/mpeg"></audio>

<div id="top">
    <div id="stats">
        <div class="stat-item">CASH<br><span id="c-val">$200</span></div>
        <div class="stat-item">LVL<br><span id="l-val">1</span></div>
        <div class="stat-item">STOCK<br><span id="s-val">0/36</span></div>
        <div class="stat-item">XP<br><span id="x-val">0%</span></div>
    </div>
    <div style="text-align:center; padding: 5px;">
        <button onclick="buyCleaner()" style="font-size: 0.7rem; padding: 4px 8px;">HIRE CLEANER ($150)</button>
    </div>
</div>

<div id="game">
    <div class="shelf" id="s1"><div class="items" id="i1"></div><img src="shelf.png" width="100%"></div>
    <div class="shelf" id="s2"><div class="items" id="i2"></div><img src="shelf.png" width="100%"></div>
    <div class="shelf" id="s3"><div class="items" id="i3"></div><img src="shelf.png" width="100%"></div>
    <div class="shelf" id="s4"><div class="items" id="i4"></div><img src="shelf.png" width="100%"></div>

    <img src="player.png" class="actor" id="player">
    <img src="counter.png" id="counter">
    <img src="man_idle.png" class="actor" id="customer">
    <img src="cleaner_idle.png" class="actor" id="cleaner">

    <div id="btn-cash" onclick="doSale()">COLLECT CASH ðŸ’°</div>
</div>

<div id="footer">
    <button class="btn" onclick="refill()">REFILL STOCK ($50)</button>
</div>

<script>
    let cash = 200, stock = 0, xp = 0, lvl = 1, busy = false, cleanerActive = false;
    let custType = "";
    const items = ["ðŸŽ", "ðŸ¥›", "ðŸž", "ðŸª"];

    document.addEventListener('click', () => { document.getElementById('bgm').play(); }, {once: true});

    function update() {
        document.getElementById('c-val').innerText = `$${cash}`;
        document.getElementById('s-val').innerText = `${stock}/36`;
        document.getElementById('x-val').innerText = `${xp}%`;
        
        // 9-Item Shelf Logic
        for(let s=1; s<=4; s++) {
            const grid = document.getElementById(`i${s}`);
            grid.innerHTML = "";
            let start = (s-1) * 9;
            let end = Math.min(stock, s * 9);
            for(let i=start; i<end; i++) grid.innerHTML += `<span>${items[i%4]}</span>`;
        }
    }

    function refill() {
        if(cash >= 50) { cash -= 50; stock = Math.min(stock + 12, 36); update(); }
    }

    function buyCleaner() {
        if(cash >= 150) { cash -= 150; cleanerActive = true; document.getElementById('cleaner').style.display = 'block'; update(); }
    }

    function spawn() {
        if(busy) return; busy = true;
        const c = document.getElementById('customer');
        const types = ["man", "old_lady", "police"];
        custType = types[Math.floor(Math.random() * 3)];
        c.src = `${custType}_walk.png`;
        c.style.left = "42%";
        setTimeout(() => {
            c.src = `${custType}_idle.png`;
            if(stock > 0) document.getElementById('btn-cash').style.display = 'block';
            else leave();
        }, 1200);
    }

    function doSale() {
        cash += (custType === "police") ? 100 : 50;
        stock--; xp += 25;
        document.getElementById('btn-cash').style.display = 'none';
        if(Math.random() > 0.4) createGarbage();
        if(xp >= 100) { xp=0; lvl++; }
        update(); leave();
    }

    function createGarbage() {
        const g = document.createElement('div');
        g.className = 'garbage';
        g.innerHTML = 'ðŸ—‘ï¸';
        let pos = (20 + Math.random() * 40) + "%";
        g.style.left = pos;
        document.getElementById('game').appendChild(g);

        if(cleanerActive) {
            const cleaner = document.getElementById('cleaner');
            cleaner.style.left = pos; // Cleaner moves to garbage
            setTimeout(() => {
                g.remove();
                cash += 10; update();
                cleaner.style.left = "80%"; // Cleaner returns
            }, 1000);
        } else {
            g.onclick = () => { g.remove(); cash += 5; update(); };
        }
    }

    function leave() {
        const c = document.getElementById('customer');
        c.src = `${custType}_walk.png`;
        c.style.left = "110%";
        setTimeout(() => {
            c.style.transition = "none"; c.style.left = "-200px";
            setTimeout(() => { c.style.transition = "left 1s linear"; busy = false; }, 100);
        }, 1200);
    }

    setInterval(spawn, 5000);
    update();
</script>
</body>
</html>
