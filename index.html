<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shop Simulator - Cleaning Edition</title>
    <style>
        body {
            margin: 0; overflow: hidden; display: flex;
            flex-direction: column; justify-content: center; align-items: center;
            height: 100vh; background: #1a1a1a; font-family: 'Courier New', monospace;
        }

        #game-container {
            width: 85vw; height: 70vh; background: #2c3e50;
            position: relative; display: flex; flex-direction: column;
            justify-content: flex-end; align-items: center;
            transition: all 0.5s ease; border: 5px solid #5d4037;
        }

        /* Cleaning Warning Message */
        #clean-warning {
            position: absolute; top: 20px; background: #e74c3c; color: white;
            padding: 10px 30px; border-radius: 10px; font-weight: bold;
            display: none; z-index: 500; animation: blink 1s infinite;
        }
        @keyframes blink { 0% {opacity: 1;} 50% {opacity: 0.5;} 100% {opacity: 1;} }

        /* Trash/Dirt Spots */
        .trash {
            position: absolute; width: 40px; height: 40px; 
            font-size: 30px; cursor: pointer; z-index: 15;
            transition: transform 0.2s;
        }
        .trash:hover { transform: scale(1.2); }

        .shelf-container {
            position: absolute; top: 10%; width: 90%;
            display: flex; justify-content: space-around; z-index: 2;
        }
        .rack {
            width: 150px; height: 120px; background: #5d4037;
            border: 4px solid #4a332a; display: grid;
            grid-template-rows: repeat(2, 1fr); gap: 5px; padding: 5px;
        }
        .shelf-row { border-bottom: 2px solid #4a332a; display: flex; justify-content: space-around; align-items: center; font-size: 25px; }

        .floor {
            position: absolute; bottom: 0; width: 100%; height: 35%;
            background: #5d4037; border-top: 10px solid #4a332a; z-index: 1;
        }

        .counter {
            position: absolute; bottom: 28%; width: 500px; height: 130px;
            background: #8b4513; border: 5px solid #5d4037; z-index: 10;
        }

        #player-sprite {
            position: absolute; bottom: 38%; width: 180px; 
            left: 50%; transform: translateX(-50%);
            z-index: 5; image-rendering: pixelated; transition: left 0.1s linear;
        }

        #customer-sprite {
            position: absolute; bottom: 22%; left: -300px; 
            width: 160px; z-index: 20; transition: left 1.5s linear;
            image-rendering: pixelated;
        }

        #ui-panel {
            width: 100%; height: 140px; background: #e1b382;
            border-top: 5px solid #5d4037; display: flex;
            justify-content: center; align-items: center; gap: 15px;
        }
        .stat-box { background: #5d4037; color: #f1c40f; padding: 8px 15px; border-radius: 5px; font-weight: bold; }
        .game-btn { padding: 12px 20px; font-weight: bold; cursor: pointer; border: none; border-radius: 10px; color: white; }

        #demand-bubble {
            position: absolute; bottom: 60%; left: 40%;
            background: white; padding: 10px; border-radius: 10px;
            display: none; font-weight: bold; z-index: 200; border: 2px solid black;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="clean-warning">‚ö†Ô∏è CLEAN SHOP! CUSTOMERS ARE LEAVING!</div>
    <div id="demand-bubble"></div>
    <div class="shelf-container" id="shelves">
        <div class="rack"><div class="shelf-row"><span class="slot"></span><span class="slot"></span></div><div class="shelf-row"><span class="slot"></span><span class="slot"></span></div></div>
    </div>
    
    <div class="floor" id="floor-area"></div>
    <img src="player.png" id="player-sprite">
    <div class="counter"></div>
    <img src="ladycustomar.png" id="customer-sprite">
    
    <button id="bill-btn" class="game-btn" style="position:absolute; bottom:48%; left:50%; transform:translateX(-50%); background:#f1c40f; color:black; display:none; z-index:150;" onclick="processBill()">SELL üßæ</button>
</div>

<div id="ui-panel">
    <div class="stat-box">üí∞ $<span id="cash">150</span></div>
    <div class="stat-box">üßπ DIRT: <span id="dirt-count">0</span></div>
    <button class="game-btn" style="background: #27ae60;" onclick="openLibrary()">CHOOSE ITEMS</button>
    <button class="game-btn" style="background: #f39c12;" onclick="upgradeShop()">UPGRADE ($200)</button>
    <div style="font-size:12px; color:#5d4037;">Move ‚¨ÖÔ∏è ‚û°Ô∏è | Click Trash to Clean</div>
</div>

<script>
    let cash = 150, stock = 0, dirt = 0, isWaiting = false;
    let playerPos = 50;
    let itemsInStock = [];
    const trashEmojis = ['‚òÅÔ∏è', 'üçÇ', 'üí¶', 'üí©'];

    // --- PLAYER MOVEMENT ---
    window.addEventListener('keydown', (e) => {
        const player = document.getElementById('player-sprite');
        if (e.key === 'ArrowLeft' && playerPos > 30) playerPos -= 3;
        if (e.key === 'ArrowRight' && playerPos < 70) playerPos += 3;
        player.style.left = playerPos + "%";
    });

    // --- CLEANING SYSTEM ---
    function createTrash() {
        if (!isWaiting) return; 
        dirt++;
        updateUI();
        const trash = document.createElement('div');
        trash.className = 'trash';
        trash.innerText = trashEmojis[Math.floor(Math.random() * trashEmojis.length)];
        trash.style.left = (Math.random() * 60 + 20) + "%";
        trash.style.bottom = (Math.random() * 10 + 5) + "%";
        trash.onclick = function() {
            this.remove();
            dirt--;
            updateUI();
            if (dirt < 5) document.getElementById('clean-warning').style.display = 'none';
        };
        document.getElementById('game-container').appendChild(trash);

        if (dirt >= 5) {
            document.getElementById('clean-warning').style.display = 'block';
        }
    }

    function spawnCustomer() {
        if (isWaiting) return;
        // If shop is too dirty, customers don't come
        if (dirt >= 7) {
            document.getElementById('clean-warning').innerText = "SHOP TOO DIRTY! NO CUSTOMERS!";
            return;
        }

        isWaiting = true;
        const cust = document.getElementById('customer-sprite');
        cust.src = Math.random() > 0.5 ? "ladycustomar.png" : "it_man.png";
        cust.style.left = "40%"; 
        
        // Randomly make mess
        setTimeout(createTrash, 2000);

        setTimeout(() => {
            const bubble = document.getElementById('demand-bubble');
            bubble.innerText = "Checking items...";
            bubble.style.display = "block";
            // ... (Rest of billing logic same as before)
            setTimeout(customerLeave, 2000); 
        }, 1500);
    }

    function customerLeave() {
        document.getElementById('demand-bubble').style.display = "none";
        document.getElementById('bill-btn').style.display = "none";
        const cust = document.getElementById('customer-sprite');
        cust.style.left = "110%";
        setTimeout(() => { 
            cust.style.transition="none"; cust.style.left="-300px"; 
            setTimeout(()=> {cust.style.transition="left 1.5s linear"; isWaiting=false;}, 50); 
        }, 1500);
    }

    function updateUI() {
        document.getElementById('cash').innerText = cash;
        document.getElementById('dirt-count').innerText = dirt;
    }

    setInterval(spawnCustomer, 6000);
</script>
</body>
</html>
