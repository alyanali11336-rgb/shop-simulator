<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shop Sim - Guard & 50-Stacks</title>
    <style>
        :root { --ui-panel: #3e2723; --gold: #f1c40f; }
        body { margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; background: #1a1a1a; overflow: hidden; font-family: sans-serif; }

        /* Stats & Hiring Menu */
        #top-ui { background: var(--ui-panel); border-bottom: 4px solid var(--gold); z-index: 100; }
        #stats-bar { display: grid; grid-template-columns: repeat(4, 1fr); padding: 10px; }
        .stat-item { color: var(--gold); text-align: center; font-size: 0.8rem; font-weight: bold; }
        
        #hire-bar { display: flex; justify-content: center; padding: 8px; gap: 10px; background: rgba(0,0,0,0.3); }
        .btn-hire { background: #8e44ad; color: white; border: none; padding: 6px 12px; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 0.75rem; }

        /* Game Stage */
        #stage { flex: 1; position: relative; background: linear-gradient(#2c3e50 65%, #4a332d 65%); }

        /* 50-Item Stacks on 4 Shelves */
        .shelf-box { position: absolute; width: 120px; height: 90px; z-index: 5; }
        #s1 { top: 15%; left: 5%; } #s2 { top: 15%; right: 5%; }
        #s3 { top: 38%; left: 5%; } #s4 { top: 38%; right: 5%; }

        .items-layer { 
            position: absolute; bottom: 15px; width: 100%; 
            display: flex; flex-wrap: wrap-reverse; justify-content: center; 
            gap: 2px; max-height: 70px; 
        }
        .items-layer span { font-size: 1.2rem; line-height: 0.9; }

        /* Assets Position */
        #counter { position: absolute; bottom: 26%; left: 50%; transform: translateX(-50%); width: 180px; z-index: 15; }
        .actor { position: absolute; height: 145px; width: auto; transition: left 1.5s linear; }
        #player { bottom: 33%; left: 50%; transform: translateX(-50%); z-index: 10; }
        #customer { bottom: 9%; left: -200px; z-index: 20; }
        #cleaner { bottom: 9%; right: 15%; display: none; }
        #guard { bottom: 9%; left: 10%; display: none; transform: scaleX(-1); } /* Guard at entrance */

        #collect-cash { 
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            background: #f39c12; color: white; padding: 12px 24px; border-radius: 50px;
            font-weight: bold; display: none; z-index: 200; border: 3px solid white;
        }

        #footer-actions { height: 10vh; background: #e1b382; display: flex; padding: 10px; border-top: 5px solid var(--ui-panel); }
        .btn-refill { flex: 1; border: none; border-radius: 10px; font-weight: bold; font-size: 1rem; color: white; background: #27ae60; }
    </style>
</head>
<body>

<audio id="bgm" loop><source src="Aylex - Innovating Care (freetouse.com).mp3" type="audio/mpeg"></audio>

<div id="top-ui">
    <div id="stats-bar">
        <div class="stat-item">CASH<br><span id="val-cash">$200</span></div>
        <div class="stat-item">LVL<br><span id="val-lvl">1</span></div>
        <div class="stat-item">STOCK<br><span id="val-stk">0/100</span></div>
        <div class="stat-item">XP<br><span id="val-xp">0%</span></div>
    </div>
    <div id="hire-bar">
        <button class="btn-hire" style="background:#2980b9;" onclick="buyStaff('cleaner', 150)">CLEANER ($150)</button>
        <button class="btn-hire" onclick="buyStaff('guard', 300)">GUARD ($300)</button>
    </div>
</div>

<div id="stage">
    <div class="shelf-box" id="s1"><div class="items-layer" id="lay-1"></div><img src="shelf.png" style="width:100%"></div>
    <div class="shelf-box" id="s2"><div class="items-layer" id="lay-2"></div><img src="shelf.png" style="width:100%"></div>
    <div class="shelf-box" id="s3"><div class="items-layer" id="lay-3"></div><img src="shelf.png" style="width:100%"></div>
    <div class="shelf-box" id="s4"><div class="items-layer" id="lay-4"></div><img src="shelf.png" style="width:100%"></div>

    <img src="player.png" class="actor" id="player"> 
    <img src="counter.png" id="counter"> 
    <img src="man_idle.png" class="actor" id="customer">
    <img src="cleaner_idle.png" class="actor" id="cleaner">
    <img src="police_idle.png" class="actor" id="guard"> <div id="collect-cash" onclick="finishSale()">COLLECT $</div>
</div>

<div id="footer-actions">
    <button class="btn-refill" onclick="restock()">REFILL STOCK ($50)</button>
</div>

<script>
    let money = 200, level = 1, stock = 0, xp = 0, isBusy = false, guardActive = false;
    let currentType = "";
    const emojiList = ["ðŸŽ", "ðŸ¥›", "ðŸž", "ðŸ•", "ðŸª"];

    document.addEventListener('click', () => { 
        const m = document.getElementById('bgm'); 
        if(m.paused) { m.volume=0.2; m.play(); } 
    }, {once: true});

    function updateView() {
        document.getElementById('val-cash').innerText = `$${money}`;
        document.getElementById('val-lvl').innerText = level;
        document.getElementById('val-stk').innerText = `${stock}/100`;
        document.getElementById('val-xp').innerText = `${xp}%`;
        
        // Stacking Logic for 50 items per side (25 per shelf)
        for(let i=1; i<=4; i++) {
            const layer = document.getElementById(`lay-${i}`);
            layer.innerHTML = "";
            let start = (i-1)*25;
            let end = Math.min(stock, i*25);
            for(let j=start; j<end; j++) {
                layer.innerHTML += `<span>${emojiList[j % emojiList.length]}</span>`;
            }
        }
    }

    function restock() {
        if(money >= 50) { money -= 50; stock = Math.min(stock + 40, 100); updateView(); }
    }

    function buyStaff(role, price) {
        if(money >= price) {
            money -= price;
            if(role === 'guard') { guardActive = true; document.getElementById('guard').style.display = 'block'; }
            else { document.getElementById('cleaner').style.display = 'block'; }
            updateView();
        }
    }

    function spawnCust() {
        if(isBusy) return; isBusy = true;
        const c = document.getElementById('customer');
        const types = ["man", "old_lady", "police"];
        currentType = types[Math.floor(Math.random() * types.length)];
        
        c.src = `${currentType}_walk.png`;
        c.style.left = (guardActive) ? "25%" : "42%"; // Guard checks first

        setTimeout(() => {
            if(guardActive) { xp += 5; updateView(); } // Guard bonus
            c.style.left = "42%";
            setTimeout(() => {
                c.src = `${currentType}_idle.png`;
                if(stock > 0) document.getElementById('collect-cash').style.display = 'block';
                else leaveShop();
            }, 1000);
        }, 1000);
    }

    function finishSale() {
        money += (currentType === "police") ? 120 : 60;
        stock--; xp += 20;
        document.getElementById('collect-cash').style.display = 'none';
        if(xp >= 100) { xp=0; level++; }
        updateView(); leaveShop();
    }

    function leaveShop() {
        const c = document.getElementById('customer');
        c.src = `${currentType}_walk.png`;
        c.style.left = "110%";
        setTimeout(() => {
            c.style.transition = "none"; c.style.left = "-200px";
            setTimeout(() => { c.style.transition = "left 1.5s linear"; isBusy = false; }, 100);
        }, 1500);
    }

    setInterval(spawnCust, 5000);
    updateView();
</script>
</body>
</html>
